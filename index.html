<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  
  <title>New Power</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
  <meta name="description" content="No matter how far you may fly, never forget where you come from">
<meta property="og:type" content="website">
<meta property="og:title" content="New Power">
<meta property="og:url" content="https://hbcrhythm.github.io/index.html">
<meta property="og:site_name" content="New Power">
<meta property="og:description" content="No matter how far you may fly, never forget where you come from">
<meta property="og:locale" content="zh-CN">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="New Power">
<meta name="twitter:description" content="No matter how far you may fly, never forget where you come from">
  
    <link rel="alternate" href="/atom.xml" title="New Power" type="application/atom+xml">
  
  
    <link rel="icon" href="/favicon.png">
  
  
    <link href="//fonts.googleapis.com/css?family=Source+Code+Pro" rel="stylesheet" type="text/css">
  
  <link rel="stylesheet" href="/css/style.css">
  

</head>

<body>
  <div id="container">
    <div id="wrap">
      <header id="header">
  <div id="banner"></div>
  <div id="header-outer" class="outer">
    <div id="header-title" class="inner">
      <h1 id="logo-wrap">
        <a href="/" id="logo">New Power</a>
      </h1>
      
        <h2 id="subtitle-wrap">
          <a href="/" id="subtitle">No matter how far you may fly, never forget where you come from</a>
        </h2>
      
    </div>
    <div id="header-inner" class="inner">
      <nav id="main-nav">
        <a id="main-nav-toggle" class="nav-icon"></a>
        
          <a class="main-nav-link" href="/">Home</a>
        
          <a class="main-nav-link" href="/archives">Archives</a>
        
      </nav>
      
    </div>
  </div>
</header>
      <div class="outer">
        <section id="main">
  
    <article id="post-Erasure-Code" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2018/04/07/Erasure-Code/" class="article-date">
  <time datetime="2018-04-07T10:40:50.000Z" itemprop="datePublished">2018-04-07</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2018/04/07/Erasure-Code/">Reed-Solomon Erasure Code</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <p>EC的定义：erasure code是一种技术，它可以将n份原始数据，增加m份数据(n > m)，并能通过n+m份中的任意n份数据，还原为原始数据。定义中包含了encode和decode两个过程，将原始<br>的n份数据变为n+m份是encode，之后这n+m份数据可存放在不同的device上，如果有任意小于m份的数据失效，仍然能通过剩下的数据还原出来。</p>
<p>EC主要是通过纠删码算法将原始的数据进行编码得到冗余，并将数据和冗余一并存储起来，以达到容错的目的。</p>
<p>在数据存储领域， 一般有多副本，EC两种数据冗余技术，EC的话，可以很大程度上增加我们磁盘的利用率。<br>例如：</p>
<pre><code>多副本
    1个副本，假设我们存储2个备份副本,那么总共就3个副本了,10个副本数据就是30个副本要存储，这样我们同一个数据也只是能容忍丢掉3次。
EC
    1个副本，10个副本数据我们如果n=10, m=4, 只需要14个副本。这样我们可以容忍你丢掉任意3个副本。
</code></pre><p>在直播，游戏领域，采用EC可以增加我们的抗丢包能力。</p>
<p>EC原理不复杂，理解的话需要一些矩阵的知识，例如</p>
<ol>
<li>逆矩阵。</li>
<li>单位矩阵。</li>
<li>矩阵*逆矩阵= 单位矩阵。</li>
<li>任何一个矩阵乘以单位矩阵都不变。</li>
</ol>
<p>详细原理和代码可以参考以下资料。</p>
<p><a href="https://www.backblaze.com/blog/reed-solomon/" target="_blank" rel="noopener">Backblaze blog.</a><br><a href="https://en.wikipedia.org/wiki/Forward_error_correction" target="_blank" rel="noopener">Forward error correction</a><br><a href="https://github.com/klauspost/reedsolomon" target="_blank" rel="noopener">Reed-Solomon Erasure Coding in Go</a></p>

      
    </div>
    <footer class="article-footer">
      <a data-url="https://hbcrhythm.github.io/2018/04/07/Erasure-Code/" data-id="cjfpiwkth0002q0veu0btts9z" class="article-share-link">Share</a>
      
      
    </footer>
  </div>
  
</article>

 
  
    <article id="post-kcp-erlang" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2018/04/01/kcp-erlang/" class="article-date">
  <time datetime="2018-04-01T14:44:43.000Z" itemprop="datePublished">2018-04-01</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2018/04/01/kcp-erlang/">kcp_erlang</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <p>这是一个erlang版本的kcp实现，这里的定位，暂时只是作为demo，供大家学习与参考，如果要变成一个成熟的库还需要加不少东西。后面如果时间稍微充裕一些的话，会继续完善。</p>
<p><a href="https://github.com/hbcrhythm/kcp_erlang" target="_blank" rel="noopener">Demo</a></p>

      
    </div>
    <footer class="article-footer">
      <a data-url="https://hbcrhythm.github.io/2018/04/01/kcp-erlang/" data-id="cjfpiwktu0009q0vec6gjuvn4" class="article-share-link">Share</a>
      
      
    </footer>
  </div>
  
</article>

 
  
    <article id="post-kcp-Socket" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2018/04/01/kcp-Socket/" class="article-date">
  <time datetime="2018-04-01T04:55:34.000Z" itemprop="datePublished">2018-04-01</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2018/04/01/kcp-Socket/">kcp-Socket</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <p>整理了一份c#版本的Kcp， <a href="https://github.com/hbcrhythm/KCP-Socket" target="_blank" rel="noopener">Demo</a><br>可以直接在Unity里面使用，我在代码里添加了一些注释，让小伙伴们可以更快的理解Kcp和Demo。</p>
<p>Demo里面有些功能缺失了，例如发送的流模式和消息模式，现在只有消息模式，后面博主有时间的话会改过来。</p>
<p>博主昨天调试了Demo和一份Kcp-Erlang版本的进行通信，已经完成了，但两边细节都还需要优化，后续做完会放出来。 </p>

      
    </div>
    <footer class="article-footer">
      <a data-url="https://hbcrhythm.github.io/2018/04/01/kcp-Socket/" data-id="cjfpiwkty000cq0ved776u69p" class="article-share-link">Share</a>
      
      
    </footer>
  </div>
  
</article>

 
  
    <article id="post-nifty" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2018/03/31/nifty/" class="article-date">
  <time datetime="2018-03-30T16:10:36.000Z" itemprop="datePublished">2018-03-31</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2018/03/31/nifty/">nifty</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <p>本文章主要讲 nifty 的安装过程，因为这次坑似乎略多，所以在这里记录下。<br>github 地址 ： <a href="https://github.com/parapluu/nifty.git" target="_blank" rel="noopener">https://github.com/parapluu/nifty.git</a></p>
<p>环境:<br>CentOS release 6.8 (Final)</p>
<p>项目的README.md文件中可以看到，nifty的依赖主要是clang compiler 和 libclang<br>先看<a href="http://clang.llvm.org/get_started.html官方给出的安装说明。" target="_blank" rel="noopener">http://clang.llvm.org/get_started.html官方给出的安装说明。</a><br>大概需要的文件这里列下</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">Package		Version			Notes</span><br><span class="line">GNU Make	3.79, 3.79.1	Makefile/build processor</span><br><span class="line">GCC			&gt;=4.8.0			C/C++ compiler1</span><br><span class="line">python		&gt;=2.7			Automated test suite2</span><br><span class="line">zlib		&gt;=1.2.3.4		Compression library3</span><br></pre></td></tr></table></figure>
<p>大概分4大块来安装</p>
<p> <strong>1.</strong> gcc ，python 版本 。<br>        <a href="https://github.com/hbcrhythm/ansible-work-centos/blob/master/src/roles/common/tasks/upgrade_gcc.yml" target="_blank" rel="noopener">devtoolset-3-toolchain ansible demo</a><br>        <a href="https://github.com/hbcrhythm/ansible-work-centos/blob/master/src/roles/common/tasks/upgrade_python.yml" target="_blank" rel="noopener">python ansible demo</a></p>
<pre><code>安装devtoolset-3-toolchain来解决GCC版本问题，安装完成之后开启就可以。
关于如何安装devtoolset-3-toolchain 可以看我的ansible demo 中关于gcc的升级和开启。
剩下的python zlib这些比较简单自己装了。
python部分也可以看我的ansible demo中关于python安装的部分。
</code></pre><p> <strong>2.</strong> cmake </p>
<pre><code>wget https://cmake.org/files/v3.7/cmake-3.7.1.tar.gz
tar xzf cmake-3.7.1.tar.gz
cd cmake-3.7.1
./bootstrap
gmake -j$(nproc)
make install
cd ..
</code></pre><p> <strong>3.</strong> clang(这里安装的时候在make -j$(nproc) 的时候博主层出现过报错，后面的解决方式是加内存，详细的报错原因没留了，这个大家装的时候可以留意下。可能有人留意到了这里不是官方给出的安装方式，其实是一样的，只是官方的example是trunk的例子，这里是用了release版本。</p>
<pre><code>wget http://llvm.org/releases/3.9.1/llvm-3.9.1.src.tar.xz
wget http://llvm.org/releases/3.9.1/cfe-3.9.1.src.tar.xz
wget http://llvm.org/releases/3.9.1/compiler-rt-3.9.1.src.tar.xz
wget http://llvm.org/releases/3.9.1/clang-tools-extra-3.9.1.src.tar.xz
tar xf llvm-3.9.1.src.tar.xz
mv llvm-3.9.1.src llvm
cd llvm/tools
tar xf ../../cfe-3.9.1.src.tar.xz
mv cfe-3.9.1.src clang
cd clang/tools
tar xf ../../../../clang-tools-extra-3.9.1.src.tar.xz
mv clang-tools-extra-3.9.1.src extra
cd ../../../projects
tar xf ../../compiler-rt-3.9.1.src.tar.xz
mv compiler-rt-3.9.1.src compiler-rt
cd ../..
mkdir llvm-build
cd llvm-build
cmake -G &quot;Unix Makefiles&quot; -DCMAKE_BUILD_TYPE=Release -DCMAKE_INSTALL_PREFIX=/home/data/software/clang3.9.1 -DLLVM_OPTIMIZED_TABLEGEN=1 ../llvm
make -j$(nproc)
make install
</code></pre><p> <strong>4</strong>. libclang.so<br>    <a href="http://parapluu.github.io/nifty/tutorial_trouble/" target="_blank" rel="noopener">链接</a></p>
<pre><code>前面都安装成功之后，在nitfy:compile的时候还会报错，那大概是报libclang.so not found, 这个问题只需要设置下环境变量 LD_LIBRARY_PATH 为libclang.so的路径就可以。
详细的解决方案看连接。
</code></pre><p> 至此,整个nifty已经安装完成了， 注意前面的操作都需要在 gcc&gt;4.8 上操作，也就是说你的devtoolset-3要一直启动着,不然会报很多奇怪的问题。</p>

      
    </div>
    <footer class="article-footer">
      <a data-url="https://hbcrhythm.github.io/2018/03/31/nifty/" data-id="cjfpiwku0000dq0veir6ks7ze" class="article-share-link">Share</a>
      
      
    </footer>
  </div>
  
</article>

 
  
    <article id="post-unity-resolution" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2018/02/27/unity-resolution/" class="article-date">
  <time datetime="2018-02-27T05:16:31.000Z" itemprop="datePublished">2018-02-27</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2018/02/27/unity-resolution/">UGUI Resoulution</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <p>UGUI针对Android五花八门分辨率的屏幕自适应。</p>
<ol>
<li>Canvas 选择Screen Space-Camera 模式。</li>
<li>Canvas 设置成Orthographic模式。</li>
<li>Canvas Scaler 选择 Scale With Screen Size，并且 Screen Match Mode 选择 Match Width Or Height， 比例设置为0，只和宽度进行适配。</li>
</ol>
<p>代码上的处理：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">void InitResolution() &#123;</span><br><span class="line">    if (ClientConfig.PLATFORM != PlatformType.Android) &#123;</span><br><span class="line">        return;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    int width = Screen.currentResolution.width;</span><br><span class="line">    int height = Screen.currentResolution.height;</span><br><span class="line">    int targetWidth = 960;</span><br><span class="line">    int targetHeight = 640;</span><br><span class="line"></span><br><span class="line">    if (width &lt;= targetWidth || height &lt;= targetHeight) </span><br><span class="line">        return;</span><br><span class="line"></span><br><span class="line">    float targetRatio = targetWidth / (float)targetHeight;</span><br><span class="line">    float currentRatio = width / (float)height;</span><br><span class="line"></span><br><span class="line">    if (targetRatio &lt; currentRatio) &#123;</span><br><span class="line">        targetWidth = (int)Mathf.CeilToInt(targetHeight * currentRatio);</span><br><span class="line">    &#125; else if (targetRatio &gt; currentRatio) &#123;</span><br><span class="line">        targetHeight = (int)Mathf.FloorToInt(targetWidth / currentRatio);</span><br><span class="line">    &#125;</span><br><span class="line">    Screen.SetResolution(targetWidth, targetHeight, true);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>基本是这样，现在似乎有一款手机(哪一款忘记了)屏幕宽度是高度的2倍+的，这个要特殊处理下，<br>直接把Canvas Scaler 的 Match Width Or Height 比例设置成1。</p>

      
    </div>
    <footer class="article-footer">
      <a data-url="https://hbcrhythm.github.io/2018/02/27/unity-resolution/" data-id="cjfpiwku2000fq0veclg4y04t" class="article-share-link">Share</a>
      
      
    </footer>
  </div>
  
</article>

 
  
    <article id="post-Read-Code" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2018/02/24/Read-Code/" class="article-date">
  <time datetime="2018-02-24T15:11:27.000Z" itemprop="datePublished">2018-02-24</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2018/02/24/Read-Code/">速读代码</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <p>今天看到一些人在网上讨论关于读代码的问题，引发了一些思考。这里我写下个人的一些看法。</p>
<p>可能大家遇到过一样的问题，发现github某款项目的核心思想很好，我们想去了解它具体的实现，但是直接去撸的话发现代码量庞大，甚至有一些奇淫技巧在里面，读起来吃力且费时间，并且因为我们的目的很明确，只想了解它的核心思想实现，不想花费太多的时间在其他方面。</p>
<p>对于这种情况，可以选择的一个方法是翻他的历史记录，去读他的第一版或前几个版本的的代码，通常早期的版本可以用一个词来总结:”麻雀虽小五脏俱全”, 这个版本的代码量通常不多，并且设计的思想很明确，思路很清晰，处理问题具有针对性，这个阶段的源码比较适合我们去了解它的核心思想或者说背后的设计理念，而且一个流程下来我们花费的时间也不多。</p>
<p>至于后面代码变的复杂，因为核心功能确定之后，代码不断的重构和优化，版本不断的迭代，堆叠起来就渐渐的把项目弄复杂。</p>
<p>这或许就是古语中说的:”拨开云雾见月明”。</p>

      
    </div>
    <footer class="article-footer">
      <a data-url="https://hbcrhythm.github.io/2018/02/24/Read-Code/" data-id="cjfpiwkti0003q0veb97wzire" class="article-share-link">Share</a>
      
      
    </footer>
  </div>
  
</article>

 
  
    <article id="post-GAME-AI" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2018/02/13/GAME-AI/" class="article-date">
  <time datetime="2018-02-12T16:35:07.000Z" itemprop="datePublished">2018-02-13</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2018/02/13/GAME-AI/">GAME-AI</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <p>AI是artificial intelligence的简称，人工智能，在游戏项目开发中，AI也是很重要的一部分。</p>
<p>现在流行的AI写法，主要有3种: FSM(状态机), HFSM(分层状态机)和BT(行为树)。<br>网上资料很多，但对于初学者来说可能会有点迷，因为无法从众多的资料中挑选出价值相对较高的文章，这里博主就列出一些比较有价值的文章和代码，节省初学者的时间（这里只是给需要的了解这方面的同学一点点小方向）。</p>
<ol>
<li><a href="https://github.com/Tencent/behaviac" target="_blank" rel="noopener">腾讯开源的Behavior</a></li>
<li><a href="http://www.aisharing.com/" target="_blank" rel="noopener">AI分享站</a></li>
<li><a href="https://segmentfault.com/a/1190000012397660" target="_blank" rel="noopener">游戏AI—行为树研究及实现</a></li>
</ol>
<p>腾讯的Behavior很有研究价值。<br>这3样东西下肚，知识是可以的，剩下就只需要在实践中把知识转变成能力。</p>
<p>（博主本来想写篇c#版本的behavior tree来讲讲的，但是觉得应该没这些资料写得详细，所以还是给大家指指方向，少走弯路。同时也记录下自己以前学习的脚印，共勉）</p>

      
    </div>
    <footer class="article-footer">
      <a data-url="https://hbcrhythm.github.io/2018/02/13/GAME-AI/" data-id="cjfpiwktj0004q0vedufwwg0i" class="article-share-link">Share</a>
      
      
    </footer>
  </div>
  
</article>

 
  
    <article id="post-Abstract-Factory" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2018/02/10/Abstract-Factory/" class="article-date">
  <time datetime="2018-02-10T14:33:59.000Z" itemprop="datePublished">2018-02-10</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2018/02/10/Abstract-Factory/">Abstract Factory</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <p>在面向对象的程序语言中，我们经常听到设计模式这个名词，其实呢，大部分设计模式我们在写项目的过程中都或多或少的用到了, 例如 Template, Strategy, Adapter, Proxy, Builder等等，只是可能我们不知道它被称呼为这个名字。<br>虽然设计模式的类型繁多, 但是有些是比较经典的(可能让人第一次见就觉得醒醐灌顶吧。),<br>例如Singleton, Abstract Factory, Observer, Visitor等。</p>
<p>Singleton和ObServer在项目中应该都是遍地的，Visitor其实本质是函数式语言中的”模式匹配”,<br>这里就写篇关于Abstract Factory在游戏中的一个应用。</p>
<p>在游戏中，我们经常需要创建各类怪物，角色，宠物，陷阱等等。<br>如若需要根据副本类型优雅的创建各类怪物，并且尽量的降低耦合度，用Abstract Factory 模式是一个很好的选择， 下面贴下我写的代码。（也是Abstract Factory在游戏中的一种使用方式, 代码里面在创建相应的类型对象的时候使用了SimpleFactory模式.）</p>
<p>最后，说下个人观点<br>关于设计模式在程序中应用，也要把握适当才行，如果你觉得你的代码是直接的，精巧的，简单的，那么就是最好的，如果在写代码的时候过分在意设计模式，可能会让本身应该简洁的代码绕了几个弯哦~</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br><span class="line">243</span><br><span class="line">244</span><br><span class="line">245</span><br><span class="line">246</span><br><span class="line">247</span><br><span class="line">248</span><br><span class="line">249</span><br><span class="line">250</span><br><span class="line">251</span><br><span class="line">252</span><br><span class="line">253</span><br><span class="line">254</span><br><span class="line">255</span><br><span class="line">256</span><br><span class="line">257</span><br><span class="line">258</span><br><span class="line">259</span><br><span class="line">260</span><br><span class="line">261</span><br><span class="line">262</span><br><span class="line">263</span><br><span class="line">264</span><br><span class="line">265</span><br><span class="line">266</span><br><span class="line">267</span><br><span class="line">268</span><br><span class="line">269</span><br><span class="line">270</span><br><span class="line">271</span><br><span class="line">272</span><br><span class="line">273</span><br><span class="line">274</span><br><span class="line">275</span><br><span class="line">276</span><br><span class="line">277</span><br><span class="line">278</span><br><span class="line">279</span><br><span class="line">280</span><br><span class="line">281</span><br><span class="line">282</span><br><span class="line">283</span><br><span class="line">284</span><br><span class="line">285</span><br><span class="line">286</span><br><span class="line">287</span><br><span class="line">288</span><br><span class="line">289</span><br><span class="line">290</span><br><span class="line">291</span><br><span class="line">292</span><br><span class="line">293</span><br><span class="line">294</span><br><span class="line">295</span><br><span class="line">296</span><br></pre></td><td class="code"><pre><span class="line">using UnityEngine;</span><br><span class="line">using System.Collections;</span><br><span class="line">using System.Collections.Generic;</span><br><span class="line"></span><br><span class="line">public enum OBJ_TYPE&#123;</span><br><span class="line">	MON = 1,</span><br><span class="line">	PET = 2,</span><br><span class="line">	PLAYER = 3</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">public enum MON_TYPE&#123;</span><br><span class="line">	NORMAL = 1,</span><br><span class="line">	LEGEND = 2</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">public enum PET_TYPE&#123;</span><br><span class="line">	NORMAL = 1,</span><br><span class="line">	LEGEND = 2</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">public enum PLAYER_TYPE&#123;</span><br><span class="line">	NORMAL = 1,</span><br><span class="line">	LEGEND = 2</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">abstract class Ab_ObjFactory&#123;</span><br><span class="line">	public abstract List&lt;Ab_Obj&gt; Create();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">abstract class Ab_Obj&#123;</span><br><span class="line"></span><br><span class="line">	public abstract void Init();</span><br><span class="line"></span><br><span class="line">	protected OBJ_TYPE _type = 0;</span><br><span class="line">	public abstract OBJ_TYPE Type &#123;</span><br><span class="line">		get;</span><br><span class="line">		set;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	public static T Create&lt;T&gt;() where T : Ab_Obj, new()&#123;</span><br><span class="line">		T t = new T ();</span><br><span class="line">		return t;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">abstract class Ab_ObjMon : Ab_Obj&#123;</span><br><span class="line">	public override OBJ_TYPE Type&#123;</span><br><span class="line">		get&#123; </span><br><span class="line">			return OBJ_TYPE.MON;</span><br><span class="line">		&#125;</span><br><span class="line">		set&#123; </span><br><span class="line">			_type = OBJ_TYPE.MON;</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	protected MON_TYPE _subType;</span><br><span class="line">	public abstract MON_TYPE SubType&#123;</span><br><span class="line">		get;</span><br><span class="line">		set;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">abstract class Ab_ObjPet : Ab_Obj&#123;</span><br><span class="line">	public override OBJ_TYPE Type&#123;</span><br><span class="line">		get&#123; </span><br><span class="line">			return OBJ_TYPE.PET;</span><br><span class="line">		&#125;</span><br><span class="line">		set&#123; </span><br><span class="line">			_type = OBJ_TYPE.PET;</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	protected PET_TYPE _subType;</span><br><span class="line">	public abstract PET_TYPE SubType&#123;</span><br><span class="line">		get;</span><br><span class="line">		set;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">abstract class Ab_ObjPlayer : Ab_Obj&#123;</span><br><span class="line">	public override OBJ_TYPE Type&#123;</span><br><span class="line">		get&#123; </span><br><span class="line">			return OBJ_TYPE.PLAYER;</span><br><span class="line">		&#125;</span><br><span class="line">		set&#123; </span><br><span class="line">			_type = OBJ_TYPE.PLAYER;</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	protected PLAYER_TYPE _subType;</span><br><span class="line">	public abstract PLAYER_TYPE SubType&#123;</span><br><span class="line">		get;</span><br><span class="line">		set;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">class ObjNormalMon : Ab_ObjMon&#123;</span><br><span class="line">	public override MON_TYPE SubType&#123;</span><br><span class="line">		get&#123; </span><br><span class="line">			return MON_TYPE.NORMAL;</span><br><span class="line">		&#125;</span><br><span class="line">		set&#123; </span><br><span class="line">			_subType = MON_TYPE.NORMAL;</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">	public override void Init()&#123;</span><br><span class="line">		Debug.Log(&quot;创建对象 NormalMon&quot;);</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">class ObjLegendMon : Ab_ObjMon&#123;</span><br><span class="line">	public override MON_TYPE SubType&#123;</span><br><span class="line">		get&#123; </span><br><span class="line">			return MON_TYPE.LEGEND;</span><br><span class="line">		&#125;</span><br><span class="line">		set&#123; </span><br><span class="line">			_subType = MON_TYPE.LEGEND;</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">	public override void Init()&#123;</span><br><span class="line">		Debug.Log (&quot;创建对象 LegendMon&quot;);</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">class ObjNormalPet : Ab_ObjPet&#123;</span><br><span class="line">	public override PET_TYPE SubType&#123;</span><br><span class="line">		get&#123; </span><br><span class="line">			return PET_TYPE.NORMAL;</span><br><span class="line">		&#125;</span><br><span class="line">		set&#123; </span><br><span class="line">			_subType = PET_TYPE.NORMAL;</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">	public override void Init()&#123;</span><br><span class="line">		Debug.Log(&quot;创建对象 NormalPet&quot;);</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">class ObjLegendPet : Ab_ObjPet&#123;</span><br><span class="line">	public override PET_TYPE SubType&#123;</span><br><span class="line">		get&#123; </span><br><span class="line">			return PET_TYPE.LEGEND;</span><br><span class="line">		&#125;</span><br><span class="line">		set&#123; </span><br><span class="line">			_subType = PET_TYPE.LEGEND;</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	public override void Init()&#123;</span><br><span class="line">		Debug.Log(&quot;创建对象 LegendPet&quot;);</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">class ObjNormalPlayer : Ab_ObjPlayer&#123;</span><br><span class="line">	public override PLAYER_TYPE SubType&#123;</span><br><span class="line">		get&#123; </span><br><span class="line">			return PLAYER_TYPE.NORMAL;</span><br><span class="line">		&#125;</span><br><span class="line">		set&#123; </span><br><span class="line">			_subType = PLAYER_TYPE.NORMAL;</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	public override void Init()&#123;</span><br><span class="line">		Debug.Log(&quot;创建对象 NormalPlayer&quot;);</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">class ObjLegendPlayer : Ab_ObjPlayer&#123;</span><br><span class="line">	public override PLAYER_TYPE SubType&#123;</span><br><span class="line">		get&#123; </span><br><span class="line">			return PLAYER_TYPE.LEGEND;</span><br><span class="line">		&#125;</span><br><span class="line">		set&#123; </span><br><span class="line">			_subType = PLAYER_TYPE.LEGEND;</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	public override void Init()&#123;</span><br><span class="line">		Debug.Log (&quot;创建对象 LegendPlayer&quot;);</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">class DungeonAFactory : Ab_ObjFactory&#123;</span><br><span class="line">	public override List&lt;Ab_Obj&gt;  Create()&#123;</span><br><span class="line">		List&lt;Ab_Obj&gt; objList = new List&lt;Ab_Obj&gt; ();</span><br><span class="line">		objList.AddRange( CreateMon ());</span><br><span class="line">		objList.AddRange( CreatePet ());</span><br><span class="line">		return objList;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	public List&lt;Ab_Obj&gt; CreateMon()&#123;</span><br><span class="line">		List&lt;Ab_Obj&gt; objList = new List&lt;Ab_Obj&gt; ();</span><br><span class="line">		ObjNormalMon normalMon = Ab_Obj.Create&lt;ObjNormalMon&gt; ();</span><br><span class="line">		normalMon.Init ();</span><br><span class="line">		objList.Add (normalMon);</span><br><span class="line">		ObjLegendMon legendMon = Ab_Obj.Create&lt;ObjLegendMon&gt; ();</span><br><span class="line">		legendMon.Init ();</span><br><span class="line">		objList.Add (legendMon);</span><br><span class="line">		return objList;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	public List&lt;Ab_Obj&gt; CreatePet()&#123;</span><br><span class="line">		List&lt;Ab_Obj&gt; objList = new List&lt;Ab_Obj&gt; ();</span><br><span class="line">		ObjNormalPet normalPet = Ab_Obj.Create&lt;ObjNormalPet&gt;();</span><br><span class="line">		normalPet.Init ();</span><br><span class="line">		objList.Add (normalPet);</span><br><span class="line">		ObjLegendPet legendPet = Ab_Obj.Create&lt;ObjLegendPet&gt; ();</span><br><span class="line">		legendPet.Init ();</span><br><span class="line">		objList.Add (legendPet);</span><br><span class="line">		return objList;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">class DungeonBFactory : Ab_ObjFactory&#123;</span><br><span class="line">	public override List&lt;Ab_Obj&gt;  Create()&#123;</span><br><span class="line">		List&lt;Ab_Obj&gt; objList = new List&lt;Ab_Obj&gt; ();</span><br><span class="line">		objList.AddRange( CreateMon ());</span><br><span class="line">		objList.AddRange( CreatePet ());</span><br><span class="line">		return objList;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	public List&lt;Ab_Obj&gt; CreateMon()&#123;</span><br><span class="line">		List&lt;Ab_Obj&gt; objList = new List&lt;Ab_Obj&gt; ();</span><br><span class="line">		ObjLegendMon legendAMon = Ab_Obj.Create&lt;ObjLegendMon&gt; ();</span><br><span class="line">		legendAMon.Init ();</span><br><span class="line">		objList.Add (legendAMon);</span><br><span class="line">		ObjLegendMon legendBMon = Ab_Obj.Create&lt;ObjLegendMon&gt; ();</span><br><span class="line">		legendBMon.Init ();</span><br><span class="line">		objList.Add (legendBMon);</span><br><span class="line">		return objList;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	public List&lt;Ab_Obj&gt; CreatePet()&#123;</span><br><span class="line">		List&lt;Ab_Obj&gt; objList = new List&lt;Ab_Obj&gt; ();</span><br><span class="line">		ObjLegendPet legendAPet = Ab_Obj.Create&lt;ObjLegendPet&gt; ();</span><br><span class="line">		legendAPet.Init ();</span><br><span class="line">		objList.Add (legendAPet);</span><br><span class="line">		ObjLegendPet legendBPet = Ab_Obj.Create&lt;ObjLegendPet&gt; ();</span><br><span class="line">		legendBPet.Init ();</span><br><span class="line">		objList.Add (legendBPet);</span><br><span class="line">		return objList;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">class ArenaFactory : Ab_ObjFactory&#123;</span><br><span class="line"></span><br><span class="line">	public override List&lt;Ab_Obj&gt;  Create()&#123;</span><br><span class="line">		List&lt;Ab_Obj&gt; objList = new List&lt;Ab_Obj&gt; ();</span><br><span class="line">		objList.AddRange( CreatePlayer ());</span><br><span class="line">		return objList;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	public List&lt;Ab_Obj&gt; CreatePlayer()&#123;</span><br><span class="line">		List&lt;Ab_Obj&gt; objList = new List&lt;Ab_Obj&gt; ();</span><br><span class="line">		ObjNormalPlayer normalAPet = Ab_Obj.Create&lt;ObjNormalPlayer&gt; ();</span><br><span class="line">		normalAPet.Init ();</span><br><span class="line">		objList.Add (normalAPet);</span><br><span class="line">		ObjLegendPlayer legendBPet = Ab_Obj.Create&lt;ObjLegendPlayer&gt; ();</span><br><span class="line">		legendBPet.Init ();</span><br><span class="line">		objList.Add (legendBPet);</span><br><span class="line">		return objList;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">public class main : MonoBehaviour &#123;</span><br><span class="line"></span><br><span class="line">	void Awake() &#123;</span><br><span class="line">		DungeonAFactory normalMonFactory = new DungeonAFactory();</span><br><span class="line">		DungeonBFactory normalPetFactory = new DungeonBFactory();</span><br><span class="line">		ArenaFactory arenaFactory = new ArenaFactory ();</span><br><span class="line">		normalMonFactory.Create ();</span><br><span class="line">		normalPetFactory.Create ();</span><br><span class="line">		arenaFactory.Create ();</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	// Use this for initialization</span><br><span class="line">	void Start () &#123;</span><br><span class="line">		</span><br><span class="line">	&#125;</span><br><span class="line">	</span><br><span class="line">	// Update is called once per frame</span><br><span class="line">	void Update () &#123;</span><br><span class="line">	</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>用c#写的，在Unity里面挂上脚本贴入代码可以看到效果。</p>

      
    </div>
    <footer class="article-footer">
      <a data-url="https://hbcrhythm.github.io/2018/02/10/Abstract-Factory/" data-id="cjfpiwksu0000q0vedey87xtu" class="article-share-link">Share</a>
      
      
    </footer>
  </div>
  
</article>

 
  
    <article id="post-erlang-cookie" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2017/10/22/erlang-cookie/" class="article-date">
  <time datetime="2017-10-21T16:42:13.000Z" itemprop="datePublished">2017-10-22</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2017/10/22/erlang-cookie/">Erlang Cookie</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <p>最近在写一个cluster_demo， 遇到一个问题，我的集群中的两个节点在windows下大概是这样启动的。</p>
<pre><code>erl -name a@127.0.0.1 -setcookie aa
erl -name b@127.0.0.1 -setcookie bb
</code></pre><p>因为我知道，节点间的互连要<strong>cookie一致</strong>，我们可以通过下面这个函数设置cookie</p>
<pre><code>erlang:set_cookie(Node, NodeCookie)
</code></pre><p>或许大家看过官方文档和一些博客里面写的，集群节点可以不需要全部节点同一个cookie，只需要使用erlang:set_cookie去设置你想要连接节点的cookie。<br>我把这句话理解点代码是这样:</p>
<p>在<a href="mailto:a@127.0.0.1" target="_blank" rel="noopener">a@127.0.0.1</a>节点上，我进行如下操作</p>
<pre><code>erlang:set_cookie(&apos;b@127.0.0.1&apos;, bb)
</code></pre><p>在<a href="mailto:b@127.0.0.1" target="_blank" rel="noopener">b@127.0.0.1</a>节点上，我进行如下操作</p>
<pre><code>erlang:set_cookie(&apos;a@127.0.0.1&apos;, aa)
</code></pre><p>我以为这样的话，那么我们就可以在a或者b上直接ping通对方，但是事实却不是这样，当我在 <a href="mailto:a@127.0.0.1" target="_blank" rel="noopener">a@127.0.0.1</a> 节点上执行</p>
<pre><code>net_adm:ping(&apos;b@127.0.0.1&apos;)
</code></pre><p>他的连接并没有成功，并且提示在<a href="mailto:b@127.0.0.1" target="_blank" rel="noopener">b@127.0.0.1</a>上给我的提示是</p>
<pre><code>** Connection attempt from disallowed node ‘a@127.0.0.1&apos; **
</code></pre><p>我搜索了erlang的kernel的库代码，找到了2个地方会存在这个提示，</p>
<p>erlang kernel version: <strong>kernel-4.1.1</strong></p>
<p>dist_util.erl 151行<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">%% check if connecting node is allowed to connect with allow-node-scheme</span><br><span class="line">is_allowed(#hs_data&#123;other_node = Node, </span><br><span class="line">		    allowed = Allowed&#125; = HSData) -&gt;</span><br><span class="line">    case lists:member(Node, Allowed) of</span><br><span class="line">	false when Allowed =/= [] -&gt;</span><br><span class="line">	    send_status(HSData, not_allowed),</span><br><span class="line">	    error_msg(&quot;** Connection attempt from &quot;</span><br><span class="line">		      &quot;disallowed node ~w ** ~n&quot;, [Node]),</span><br><span class="line">	    ?shutdown(Node);</span><br><span class="line">	_ -&gt; true</span><br><span class="line">    end.</span><br></pre></td></tr></table></figure></p>
<p>dist_util.erl 591行<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">%% wait for challenge response after send_challenge</span><br><span class="line">recv_challenge_reply(#hs_data&#123;socket = Socket, </span><br><span class="line">			      other_node = NodeB,</span><br><span class="line">			      f_recv = FRecv&#125;, </span><br><span class="line">		     ChallengeA, Cookie) -&gt;</span><br><span class="line">    case FRecv(Socket, 0, infinity) of</span><br><span class="line">	&#123;ok,[$r,CB3,CB2,CB1,CB0 | SumB]&#125; when length(SumB) =:= 16 -&gt;</span><br><span class="line">	    SumA = gen_digest(ChallengeA, Cookie),</span><br><span class="line">	    ChallengeB = ?u32(CB3,CB2,CB1,CB0),</span><br><span class="line">	    ?trace(&quot;recv_reply: challenge=~w digest=~p\n&quot;,</span><br><span class="line">		   [ChallengeB,SumB]),</span><br><span class="line">	    ?trace(&quot;sum = ~p\n&quot;, [SumA]),</span><br><span class="line">	    case list_to_binary(SumB) of</span><br><span class="line">		SumA -&gt;</span><br><span class="line">		    ChallengeB;</span><br><span class="line">		_ -&gt;</span><br><span class="line">		    error_msg(&quot;** Connection attempt from &quot;</span><br><span class="line">			      &quot;disallowed node ~w ** ~n&quot;, [NodeB]),</span><br><span class="line">		    ?shutdown(NodeB)</span><br><span class="line">	    end;</span><br><span class="line">	_ -&gt;</span><br><span class="line">	    ?shutdown(no_node)</span><br><span class="line">    end.</span><br></pre></td></tr></table></figure></p>
<p>很明显，不是151行的问题，通过设置 net_kernel:allow([]) 可以排除这个问题。<br>看代码可以发现 当SumB =/= SumA的时候就会返回这个提示，SumB是接收到的，SumA是我们计算出来的，</p>
<pre><code>SumA = gen_digest(ChallengeA, Cookie)
</code></pre><p>SumA是这样生成的，查看了ChallengeA的生成代码，只是进行一些算数，然后生成的一个值<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">gen_challenge() -&gt;</span><br><span class="line">    A = erlang:phash2([erlang:node()]),</span><br><span class="line">    B = erlang:monotonic_time(),</span><br><span class="line">    C = erlang:unique_integer(),</span><br><span class="line">    &#123;D,_&#125;   = erlang:statistics(reductions),</span><br><span class="line">    &#123;E,_&#125;   = erlang:statistics(runtime),</span><br><span class="line">    &#123;F,_&#125;   = erlang:statistics(wall_clock),</span><br><span class="line">    &#123;G,H,_&#125; = erlang:statistics(garbage_collection),</span><br><span class="line">    %% A(8) B(16) C(16)</span><br><span class="line">    %% D(16),E(8), F(16) G(8) H(16)</span><br><span class="line">    ( ((A bsl 24) + (E bsl 16) + (G bsl 8) + F) bxor</span><br><span class="line">      (B + (C bsl 16)) bxor </span><br><span class="line">      (D + (H bsl 16)) ) band 16#ffffffff.</span><br></pre></td></tr></table></figure></p>
<p>打印Cookie的值，发现是aa ,正式我们在<a href="mailto:b@127.0.0.1" target="_blank" rel="noopener">b@127.0.0.1</a>上设置的<a href="mailto:a@127.0.0.1" target="_blank" rel="noopener">a@127.0.0.1</a>的cookie。<br>基本上能断定出问题的就是这个cookie值了。</p>
<p>但这里有一个情况出现，如果我们两个脚本的启动时这样的</p>
<pre><code>erl -name  a@127.0.0.1 -setcookie aa
erl -name  b@127.0.0.1 -setcookie aa
</code></pre><p>我们可以直接net_adm:ping()成功对方。<br>我们查看官方文档，erlang:set_cookie()的解释</p>
<blockquote>
<p>Sets the magic cookie of Node to the atom Cookie. If Node is the local node, the function also sets the cookie of all other unknown nodes to Cookie (see Section Distributed Erlang in the Erlang Reference Manual in System Documentation).</p>
</blockquote>
<p>因为我们启动的时候setcookie ，按照官方文档的解释，其实在<a href="mailto:a@127.0.0.1" target="_blank" rel="noopener">a@127.0.0.1</a>节点上也可以说是进行了这样操作的</p>
<pre><code>erlang:set_cookie(&apos;b@127.0.0.1&apos;， aa)
</code></pre><p>同理，在<a href="mailto:b@127.0.0.1" target="_blank" rel="noopener">b@127.0.0.1</a>上就是</p>
<pre><code>erlang:set_cookie(&apos;a@127.0.0.1&apos;, aa)
</code></pre><p>这样我们可以发现，其实他们可以互连，是因为他们都设置对方的cookie为同一个值，我们做个尝试，在两个节点上分别执行下面2个操作</p>
<pre><code>erl -name a@127.0.0.1 -setcookie aa
erlang:set_cookie(&apos;b@127.0.0.1&apos;, cc)

erl -name b@127.0.0.1 -setcookie bb
erlang:set_cookie(&apos;a@127.0.0.1&apos;, cc)
</code></pre><p>然后在进行net_adm:ping()发现，他们pong了。<br>我们可以得出结果，其实他们要互连，是需要双方将对方的cookie设置为同一个值。</p>
<p>我们在去翻下 Distributed Erlang章节的文档，发现其实是有这句话的，</p>
<blockquote>
<p>For a node Node1 with magic cookie Cookie to be able to connect to, or accept a connection from, another node Node2 with a different cookie DiffCookie, the function erlang:set_cookie(Node2, DiffCookie) must first be called at Node1. Distributed systems with multiple user IDs can be handled in this way.</p>
</blockquote>
<p>仔细看，他只是说需要在Node1 上 erlang:set_cookie(Node2, DiffCookie) ，并没有说 Node2上也需要调用erlang:set_cookie()啊。。。。。。额，其实我一直以为是文档不详细。。。。。。</p>

      
    </div>
    <footer class="article-footer">
      <a data-url="https://hbcrhythm.github.io/2017/10/22/erlang-cookie/" data-id="cjfpiwktr0007q0ve1d62gqb3" class="article-share-link">Share</a>
      
      
    </footer>
  </div>
  
</article>

 
  
    <article id="post-pomelo" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2017/09/24/pomelo/" class="article-date">
  <time datetime="2017-09-24T14:41:23.000Z" itemprop="datePublished">2017-09-24</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2017/09/24/pomelo/">pomelo</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <p>hello world。<br>今年为止，撸的框架记录下。</p>
<ul>
<li>node.js+vue webapp</li>
<li>laravel+angular side</li>
<li>egret h5 demo</li>
<li>unity+tolua game framework</li>
<li>asch</li>
</ul>
<p>前面3个在我的github上都有记录。<br>我撸框架在习惯Overleaf上画流程图，记录下框架的架构。我觉得画流程图是一个很好的方式，后面复习的话可以很清晰的回想起这个框架的架构。(非广告，嘻嘻)<br>现在, 决定开始撸pomelo 这套啦。虽然现在工作很忙，但看了这套架构的概述，还是挺好奇的。<br>这里立此贴为证，后面如果觉得有所感悟再写出来分享下啦。</p>
<p>—————————-update—————————–<br>2017/10/5<br>pomelo-chat看的七七八八了，架构图的话，其实不用自己写，pomelo wiki有丰富的的架构图，流程简图。如果大家对big world的架构有兴趣，可以读读这款。长见识嘛！</p>
<p>如果真用来做项目的话，其实不太建议，因为我本身是做erlang的，读了pomelo-chat 感觉pomelo是想在做一个node.js的erlang,那我为什么不直接用erlang来写呢。</p>
<p>pomelo的master,monitor组件挺好的，对远程服务器提供控制和监控，看看什么时候可以为现在项目弄一套。</p>
<p>end</p>

      
    </div>
    <footer class="article-footer">
      <a data-url="https://hbcrhythm.github.io/2017/09/24/pomelo/" data-id="cjfpiwktw000bq0vebzj5tvs6" class="article-share-link">Share</a>
      
      
    </footer>
  </div>
  
</article>

 
  


  <nav id="page-nav">
    <span class="page-number current">1</span><a class="page-number" href="/page/2/">2</a><a class="extend next" rel="next" href="/page/2/">__('next') &raquo;</a>
  </nav>
</section>
        
          <aside id="sidebar">
  
    

  
    

  
    
  
    
  <div class="widget-wrap">
    <h3 class="widget-title">归档</h3>
    <div class="widget">
      <ul class="archive-list"><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/04/">四月 2018</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/03/">三月 2018</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/02/">二月 2018</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/10/">十月 2017</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/09/">九月 2017</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/08/">八月 2017</a></li></ul>
    </div>
  </div>


  
    
  <div class="widget-wrap">
    <h3 class="widget-title">最新文章</h3>
    <div class="widget">
      <ul>
        
          <li>
            <a href="/2018/04/07/Erasure-Code/">Reed-Solomon Erasure Code</a>
          </li>
        
          <li>
            <a href="/2018/04/01/kcp-erlang/">kcp_erlang</a>
          </li>
        
          <li>
            <a href="/2018/04/01/kcp-Socket/">kcp-Socket</a>
          </li>
        
          <li>
            <a href="/2018/03/31/nifty/">nifty</a>
          </li>
        
          <li>
            <a href="/2018/02/27/unity-resolution/">UGUI Resoulution</a>
          </li>
        
      </ul>
    </div>
  </div>

  
</aside>
        
      </div>
      <footer id="footer">
  
  <div class="outer">
    <div id="footer-info" class="inner">
      &copy; 2018 Baocheng Huang<br>
      Powered by <a href="http://hexo.io/" target="_blank">Hexo</a>
    </div>
  </div>
</footer>
    </div>
    <nav id="mobile-nav">
  
    <a href="/" class="mobile-nav-link">Home</a>
  
    <a href="/archives" class="mobile-nav-link">Archives</a>
  
</nav>
    

<script src="//ajax.googleapis.com/ajax/libs/jquery/2.0.3/jquery.min.js"></script>


  <link rel="stylesheet" href="/fancybox/jquery.fancybox.css">
  <script src="/fancybox/jquery.fancybox.pack.js"></script>


<script src="/js/script.js"></script>

  </div>
</body>
</html>